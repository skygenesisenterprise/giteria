services:
  identity-frontend-dev:
    build:
      context: ..
      dockerfile: infra/Dockerfile.dev
    container_name: identity-frontend-dev

    # Le port est uniquement visible dans le rÃ©seau Docker
    expose:
      - "3001"

    environment:
      NODE_ENV: development
      PORT: 3001
      HOSTNAME: 0.0.0.0
      CHOKIDAR_USEPOLLING: "true"

    working_dir: /app
    user: root

    volumes:
      - ..:/app:cached
      # Note: node_modules n'est pas montÃ© car il est installÃ© dans l'image Docker
      - app_next:/app/.next

    restart: unless-stopped

    healthcheck:
      test: ["CMD", "wget", "--spider", "-q", "http://localhost:3001"]
      interval: 20s
      timeout: 5s
      retries: 3
      start_period: 30s

    # ðŸ”‘ Indexation par Traefik (lâ€™infra dÃ©cide de lâ€™exposition)
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.identity-frontend-dev.rule=Host(`localhost`) || Host(`identity.local`)"
      - "traefik.http.routers.identity-frontend-dev.entrypoints=web"
      - "traefik.http.services.identity-frontend-dev.loadbalancer.server.port=3001"
      - "traefik.http.routers.identity-frontend-dev.priority=1"

    networks:
      - identity-network-dev

networks:
  identity-network-dev:
    name: aether-network-dev
    driver: bridge

volumes:
  app_next:
