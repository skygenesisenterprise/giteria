# Dockerfile.dev — Next.js Development (no Nginx)
# Installe les dépendances pendant le build pour éviter l'installation à chaque démarrage

FROM node:20-alpine

# System dependencies (minimal)
RUN apk add --no-cache \
    libc6-compat \
    bash \
    curl \
    util-linux

# Install pnpm
RUN npm install -g pnpm@10.28.1
RUN npm install -g next

# App directory
WORKDIR /app

# Copy package files first (for better caching)
COPY package.json ./

# Install dependencies during build
# This ensures node_modules is populated in the image
RUN pnpm install --no-frozen-lockfile

# Copy the rest of the application
COPY . .

# Environment
ENV NODE_ENV=development
ENV PORT=3001
ENV HOSTNAME=0.0.0.0
ENV CHOKIDAR_USEPOLLING=true

# Expose internal port (for Traefik)
EXPOSE 3001

# Start the development server
# Dependencies are already installed, so no need to install at runtime
CMD ["pnpm", "dev"]